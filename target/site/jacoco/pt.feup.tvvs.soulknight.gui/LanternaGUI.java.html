<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LanternaGUI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Soul Knight</a> &gt; <a href="index.source.html" class="el_package">pt.feup.tvvs.soulknight.gui</a> &gt; <span class="el_source">LanternaGUI.java</span></div><h1>LanternaGUI.java</h1><pre class="source lang-java linenums">package pt.feup.tvvs.soulknight.gui;

import com.googlecode.lanterna.TextColor;
import com.googlecode.lanterna.graphics.TextGraphics;
import com.googlecode.lanterna.screen.Screen;

import java.awt.*;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import java.io.IOException;
import java.net.URISyntaxException;
import java.util.List;

import static java.awt.event.KeyEvent.*;

public class LanternaGUI implements RescalableGUI {
    private  Screen screen;
    private final ScreenGenerator screenGenerator;

    String title;

    // Track active keys
    private ResolutionScale resolutionScale;
    private KeyEvent priorityKeyPressed;
    private KeyAdapter keyAdapter;
    private KeyEvent keyPressed;
<span class="fc" id="L27">    private static final List&lt;Integer&gt; SPAM_KEYS = List.of(VK_LEFT, VK_RIGHT);</span>

<span class="fc" id="L29">    private int fps = 0;</span>

<span class="fc" id="L31">    public LanternaGUI(ScreenGenerator screenGenerator, String title) throws IOException, URISyntaxException, FontFormatException {</span>
<span class="fc" id="L32">        this.screenGenerator = screenGenerator;</span>
<span class="fc" id="L33">        this.title = title;</span>
<span class="fc" id="L34">        this.priorityKeyPressed = null;</span>
<span class="fc" id="L35">        this.keyAdapter = createKeyAdapter();</span>
<span class="fc" id="L36">        this.keyPressed = null;</span>
<span class="fc" id="L37">        setResolutionScale(null);</span>
<span class="fc" id="L38">    }</span>

    private Screen createScreen(ResolutionScale resolutionScale) throws IOException, URISyntaxException, FontFormatException {
<span class="fc" id="L41">        Screen screen = screenGenerator.createScreen(resolutionScale, title, getKeyAdapter());</span>

<span class="fc" id="L43">        screen.setCursorPosition(null);</span>
<span class="fc" id="L44">        screen.startScreen();</span>
<span class="fc" id="L45">        screen.doResizeIfNecessary();</span>
<span class="fc" id="L46">        return screen;</span>
    }

    private KeyAdapter createKeyAdapter() {
<span class="fc" id="L50">        return new KeyAdapter() {</span>
            @Override
            public void keyPressed(KeyEvent e) {
<span class="fc bfc" id="L53" title="All 2 branches covered.">                if (SPAM_KEYS.contains(e.getKeyCode()))</span>
<span class="fc" id="L54">                    keyPressed = priorityKeyPressed = e;</span>
                else
<span class="fc" id="L56">                    keyPressed = e;</span>
<span class="fc" id="L57">            }</span>

            @Override
            public void keyReleased(KeyEvent e) {
<span class="fc bfc" id="L61" title="All 2 branches covered.">                if (SPAM_KEYS.contains(e.getKeyCode()))</span>
<span class="fc" id="L62">                    keyPressed = priorityKeyPressed = null;</span>
                else
<span class="fc" id="L64">                    keyPressed = priorityKeyPressed;</span>
<span class="fc" id="L65">            }</span>
        };
    }

    @Override
    public ACTION getACTION() throws IOException {
<span class="fc bfc" id="L71" title="All 2 branches covered.">        if (keyPressed == null)</span>
<span class="fc" id="L72">            return ACTION.NULL;</span>
<span class="fc" id="L73">        int keyCode = keyPressed.getKeyCode();</span>

<span class="fc" id="L75">        keyPressed = priorityKeyPressed;</span>
        // Handle other keys
<span class="fc bfc" id="L77" title="All 10 branches covered.">        switch (keyCode) {</span>
            case VK_LEFT:
<span class="fc" id="L79">                return ACTION.LEFT;</span>
            case VK_RIGHT:
<span class="fc" id="L81">                return ACTION.RIGHT;</span>
            case VK_UP:
<span class="fc" id="L83">                return ACTION.UP;</span>
            case VK_DOWN:
<span class="fc" id="L85">                return ACTION.DOWN;</span>
            case VK_X:
<span class="fc" id="L87">                return ACTION.DASH;</span>
            case VK_ESCAPE:
<span class="fc" id="L89">                return ACTION.QUIT;</span>
            case VK_Q:
<span class="fc" id="L91">                return ACTION.KILL;</span>
            case VK_ENTER:
<span class="fc" id="L93">                return ACTION.SELECT;</span>
            case VK_SPACE:
<span class="fc" id="L95">                return ACTION.JUMP;</span>
            default:
<span class="fc" id="L97">                return ACTION.NULL;</span>
        }
    }

    public KeyAdapter getKeyAdapter() {
<span class="fc" id="L102">        return keyAdapter;</span>
    }

    @Override
    public int getWidth() {
<span class="fc" id="L107">        return screenGenerator.getWidth();</span>
    }

    @Override
    public int getHeight() {
<span class="fc" id="L112">        return screenGenerator.getWidth();</span>
    }

    @Override
    public GUI getGUI() {
<span class="fc" id="L117">        return this;</span>
    }

    @Override
    public int getFPS() {
<span class="fc" id="L122">        return fps;</span>
    }

    @Override
    public void setFPS(int fps) {
<span class="fc" id="L127">        this.fps = fps;</span>
<span class="fc" id="L128">    }</span>

    @Override
    public void cls() {
<span class="fc" id="L132">        screen.clear();</span>
<span class="fc" id="L133">    }</span>

    @Override
    public void flush() throws IOException {
<span class="fc" id="L137">        screen.refresh();</span>
<span class="fc" id="L138">    }</span>

    @Override
    public void close() throws IOException {
<span class="fc" id="L142">        screen.close();</span>
<span class="fc" id="L143">    }</span>

    @Override
    public ResolutionScale getResolutionScale() {
<span class="fc" id="L147">        return resolutionScale;</span>
    }


    @Override
    public void drawPixel(int x, int y, TextColor.RGB color) {
<span class="fc" id="L153">        TextGraphics tg = screen.newTextGraphics();</span>
<span class="fc" id="L154">        tg.setBackgroundColor(color);</span>
<span class="fc" id="L155">        tg.putString(x, y, &quot; &quot;);</span>
<span class="fc" id="L156">    }</span>

    @Override
    public void drawRectangle(int x, int y, int width, int height, TextColor.RGB color) {
<span class="fc" id="L160">        TextGraphics tg = screen.newTextGraphics();</span>
<span class="fc" id="L161">        tg.setBackgroundColor(color);</span>
<span class="fc bfc" id="L162" title="All 2 branches covered.">        for (int dy = 0; dy &lt; height; dy++) {</span>
<span class="fc bfc" id="L163" title="All 2 branches covered.">            for (int dx = 0; dx &lt; width; dx++) {</span>
<span class="fc" id="L164">                tg.putString(x + dx, y + dy, &quot; &quot;);</span>
            }
        }
<span class="fc" id="L167">    }</span>

    @Override
    public void drawHitBox(int x, int y, int width, int height, TextColor.RGB color) {
<span class="fc" id="L171">        TextGraphics tg = screen.newTextGraphics();</span>
<span class="fc" id="L172">        tg.setBackgroundColor(color);</span>

        // Draw the top and bottom edges
<span class="fc bfc" id="L175" title="All 2 branches covered.">        for (int dx = 0; dx &lt; width; dx++) {</span>
<span class="fc" id="L176">            tg.putString(x + dx, y, &quot; &quot;); // Top edge</span>
<span class="fc" id="L177">            tg.putString(x + dx, y + height - 1, &quot; &quot;); // Bottom edge</span>
        }

        // Draw the left and right edges, excluding corners to avoid duplication
<span class="fc bfc" id="L181" title="All 2 branches covered.">        for (int dy = 1; dy &lt; height - 1; dy++) {</span>
<span class="fc" id="L182">            tg.putString(x, y + dy, &quot; &quot;); // Left edge</span>
<span class="fc" id="L183">            tg.putString(x + width - 1, y + dy, &quot; &quot;); // Right edge</span>
        }
<span class="fc" id="L185">    }</span>

    @Override
    public void drawText(int x, int y, TextColor.RGB color, String Text) {
<span class="fc" id="L189">        TextGraphics tg = screen.newTextGraphics();</span>
<span class="fc" id="L190">        tg.setBackgroundColor(color);</span>
<span class="fc" id="L191">        tg.putString(x, y, Text);</span>
<span class="fc" id="L192">    }</span>

    @Override
    public void setResolutionScale(ResolutionScale resolutionScale) throws IOException, URISyntaxException, FontFormatException {
<span class="fc bfc" id="L196" title="All 2 branches covered.">        if (screen != null)</span>
<span class="fc" id="L197">            screen.close();</span>
<span class="fc" id="L198">        this.resolutionScale = resolutionScale;</span>
<span class="fc" id="L199">        this.screen = createScreen(resolutionScale);</span>
<span class="fc" id="L200">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>